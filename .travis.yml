language: python
services:
  - docker
python:
  - "2.7"
  - "3.6"
  - "3.7"
  - "3.8"
install:
  - pip install -r requirements-dev.txt
  - pip install .
  - pip install coveralls
script: nosetests --with-coverage --cover-package=datapusher
after_success:
  - coveralls

jobs:
  include:
    - stage: docker
      python: "3.7"
      install:
        - docker build -t ckan/datapusher .
        - docker run -d -p 127.0.0.1:8800:8800 --name datapusher ckan/datapusher
      script:
        - docker ps | grep -q datapusher
        - curl --fail http://localhost:8800/job
